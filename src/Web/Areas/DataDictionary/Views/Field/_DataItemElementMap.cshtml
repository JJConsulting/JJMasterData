@using JJMasterData.Core.Web
@model FormElementField
@inject IStringLocalizer<JJMasterDataResources> StringLocalizer


<script lang="javascript" type="text/javascript">

    function addElementMapFilter() {
        SpinnerOverlay.show();
        var url = "@Url.Action("AddElementMapFilter", new { elementName = ViewBag.ElementName })";
        $("form:first").attr("action", url).submit();
    }

    function removeElementMapFilter(elementMapFieldName) {
        SpinnerOverlay.show();
        $("<input>").attr({
            type: "hidden",
            id: "elementMapFieldName",
            name: "elementMapFieldName",
            value: elementMapFieldName
        }).appendTo("form");
        var url = "@Url.Action("RemoveElementMapFilter", new { elementName = ViewBag.ElementName })";
        $("form:first").attr("action", url).submit();
    }

</script>


<collapse-panel title="@StringLocalizer["Element"]" expanded-by-default="true" icon="Book">
        <div class="@BootstrapHelper.FormGroup col-sm-12 required">
            <label class="@BootstrapHelper.Label " >@StringLocalizer["ElementName"]</label>
            @Html.DropDownListFor(modelItem => modelItem.DataItem!.ElementMap!.ElementName,
                new SelectList(ViewBag.ElementNameList, "Key", "Value"),
                new { @class = "form-control form-select", onchange = "this.form.requestSubmit();" })
        </div>
</collapse-panel>

<collapse-panel title="@StringLocalizer["Element Map"]" expanded-by-default="true" icon="Map">
        <div class="row">
            <div class="@BootstrapHelper.FormGroup col-sm-4 required">
                <label class="@BootstrapHelper.Label" @BootstrapHelper.GetDataToggle("tooltip") title="@StringLocalizer["Field"]">@StringLocalizer["Field Key"]</label>
                @Html.DropDownListFor(modelItem => modelItem.DataItem!.ElementMap!.FieldKey,
                    new SelectList(ViewBag.ElementFieldList, "Key", "Value"),
                    new { @class = "form-control form-select" })
            </div>
            <div class="@BootstrapHelper.FormGroup col-sm-4">
                <label class="@BootstrapHelper.Label" @BootstrapHelper.GetDataToggle("tooltip") title="@StringLocalizer["Key"]">@StringLocalizer["Field Description"]</label>
                @Html.DropDownListFor(modelItem => modelItem.DataItem!.ElementMap!.FieldDescription,
                    new SelectList(ViewBag.ElementFieldList, "Key", "Value"),
                    new { @class = "form-control form-select" })
            </div>
        </div>
    </collapse-panel>

    
    <collapse-panel title="@StringLocalizer["Filters"]" expanded-by-default="false" icon="Filter">
                <div class="row">
                    <div class="@BootstrapHelper.FormGroup col-sm-4">
                        <label class="@BootstrapHelper.Label" @BootstrapHelper.GetDataToggle("tooltip") title="@StringLocalizer["Field"]">@StringLocalizer["Field Lookup"]</label>
                        @Html.DropDownList("mapField",
                            new SelectList(ViewBag.ElementFieldList, "Key", "Value"),
                            new { @class = "form-control" })
                    </div>
                    <div class="@BootstrapHelper.FormGroup col-sm-5">
                        <label class="@BootstrapHelper.Label" @BootstrapHelper.GetDataToggle("tooltip") title="@StringLocalizer["Field"]">@StringLocalizer["Filter Expression"]</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="mapExpressionValue" name="mapExpressionValue"/>
                            <span class="input-group-btn" style="padding-left: 10px;">
                                <button class="@BootstrapHelper.DefaultButton btn-small" onclick="addElementMapFilter();">
                                    <span class="fa fa-plus-square-o"></span>&nbsp;@StringLocalizer["Add"]
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
        
                        <table class="table table-bordered table-hover">
                            <tbody>
                            @for (int i = 0; i < Model.DataItem!.ElementMap!.MapFilters.Count; i++)
                            {
                                var mapFilter = Model.DataItem.ElementMap.MapFilters[i];
                                <tr>
                                    <td>
                                        @mapFilter.FieldName <span>=</span>@mapFilter.ExpressionValue
                                        @Html.HiddenFor(x => x.DataItem!.ElementMap!.MapFilters[i].FieldName, mapFilter.FieldName)
                                        @Html.HiddenFor(x => x.DataItem!.ElementMap!.MapFilters[i].ExpressionValue, mapFilter.ExpressionValue)
                                    </td>
                                    <td style="width:80px;" align="center">
                                        <a href="#" @BootstrapHelper.GetDataToggle("tooltip") title="Delete" onclick="removeElementMapFilter('@mapFilter.FieldName');">
                                            <span class="fa fa-trash"></span>
                                        </a>
                                    </td>
                                </tr>
                            }
                            </tbody>
                        </table>
        
                    </div>
                </div>
    </collapse-panel>
