@using JJMasterData.Core.Web
@model FormElementField
@inject IStringLocalizer<JJMasterDataResources> StringLocalizer

<collapse-panel title="@StringLocalizer["Element Map"]" expanded-by-default="true" icon="Map">
    <div class="row">
        <div class="@BootstrapHelper.FormGroup col-sm-12 required">
            <label class="@BootstrapHelper.Label ">@StringLocalizer["ElementName"]</label>
            @Html.DropDownListFor(modelItem => modelItem.DataItem!.ElementMap!.ElementName,
                new SelectList(ViewBag.ElementNameList, "Key", "Value"),
                new { @class = "form-control form-select", onchange = "this.form.requestSubmit();" })
        </div>
        <div class="@BootstrapHelper.FormGroup col-sm-3 required">
            <label class="@BootstrapHelper.Label">@StringLocalizer["Field Key"]</label>
            @Html.DropDownListFor(modelItem => modelItem.DataItem!.ElementMap!.FieldKey,
                new SelectList(ViewBag.ElementFieldList, "Key", "Value"),
                new { @class = "form-control form-select" })
        </div>
        <div class="@BootstrapHelper.FormGroup col-sm-3">
            <label class="@BootstrapHelper.Label">@StringLocalizer["Field Description"]</label>
            @Html.DropDownListFor(modelItem => modelItem.DataItem!.ElementMap!.FieldDescription,
                new SelectList(ViewBag.ElementFieldList, "Key", "Value"),
                new { @class = "form-control form-select" })
        </div>

        @if (Model.Component is FormComponent.ComboBox or FormComponent.Search && Model.DataItem!.ShowImageLegend)
        {
            <div class="@BootstrapHelper.FormGroup col-sm-3">
                <label class="@BootstrapHelper.Label">@StringLocalizer["Field Icon"]</label>
                @Html.DropDownListFor(modelItem => modelItem.DataItem!.ElementMap!.FieldDescription,
                    new SelectList(ViewBag.ElementFieldList, "Key", "Value"),
                    new { @class = "form-control form-select" })
            </div>
            <div class="@BootstrapHelper.FormGroup col-sm-3">
                <label class="@BootstrapHelper.Label">@StringLocalizer["Field Icon Color"]</label>
                @Html.DropDownListFor(modelItem => modelItem.DataItem!.ElementMap!.FieldIconColor,
                    new SelectList(ViewBag.ElementFieldList, "Key", "Value"),
                    new { @class = "form-control form-select" })
            </div>
        }
    </div>
</collapse-panel>


<collapse-panel title="@StringLocalizer["Filters"]" expanded-by-default="false" icon="Filter">
    <div class="row">
        <div class="@BootstrapHelper.FormGroup col-sm-4">
            <label class="@BootstrapHelper.Label">@StringLocalizer["Field"]</label>
            @Html.DropDownList("mapField",
                new SelectList(ViewBag.ElementFieldList, "Key", "Value"),
                new { @class = "form-control" })
        </div>
        <div class="@BootstrapHelper.FormGroup col-sm-5">
            <label class="@BootstrapHelper.Label">@StringLocalizer["Filter Expression"]</label>
            <tooltip title="Check the docs for more information about expressions."/>
            <div class="input-group">
                <input type="text" class="form-control" id="mapExpressionValue" name="mapExpressionValue"/>
                <span class="input-group-btn" style="padding-left: 10px;">
                    <button class="@BootstrapHelper.DefaultButton btn-small" onclick="addElementMapFilter();">
                        <span class="fa fa-plus-square-o"></span>&nbsp;@StringLocalizer["Add"]
                    </button>
                </span>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">

            <table class="table table-bordered table-hover">
                <tbody>
                @for (int i = 0; i < Model.DataItem!.ElementMap!.MapFilters.Count; i++)
                {
                    var mapFilter = Model.DataItem.ElementMap.MapFilters[i];
                    <tr>
                        <td>
                            @mapFilter.FieldName <span>=</span>@mapFilter.ExpressionValue
                            @Html.HiddenFor(x => x.DataItem!.ElementMap!.MapFilters[i].FieldName, mapFilter.FieldName)
                            @Html.HiddenFor(x => x.DataItem!.ElementMap!.MapFilters[i].ExpressionValue, mapFilter.ExpressionValue)
                        </td>
                        <td style="width:80px;" align="center">
                            <a href="#" @BootstrapHelper.GetDataToggle("tooltip") title="Delete" onclick="removeElementMapFilter('@mapFilter.FieldName');">
                                <span class="fa fa-trash"></span>
                            </a>
                        </td>
                    </tr>
                }
                </tbody>
            </table>

        </div>
    </div>
</collapse-panel>
<script lang="javascript" type="text/javascript">
    function addElementMapFilter() {
        const form = document.forms[0]; 
        form.action = "@Url.Action("AddElementMapFilter", new { elementName = ViewBag.ElementName })";
        form.requestSubmit();
    }
    
    function removeElementMapFilter(elementMapFieldName) {
        const form = document.forms[0];
        const input = document.createElement("input");
        input.type = "hidden";
        input.id = "elementMapFieldName";
        input.name = "elementMapFieldName";
        input.value = elementMapFieldName;
        form.appendChild(input);
        form.action = "@Url.Action("RemoveElementMapFilter", new { elementName = ViewBag.ElementName })";
        form.requestSubmit();
    }

</script>