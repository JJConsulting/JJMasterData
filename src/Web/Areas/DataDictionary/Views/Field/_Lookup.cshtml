@using JJMasterData.Core.Web
@using JJMasterData.Core.Web.Components
@using Microsoft.AspNetCore.Mvc.TagHelpers
@inject IStringLocalizer<JJMasterDataResources> StringLocalizer

@model FormElementField


<script lang="javascript" type="text/javascript">

    function addElementMapFilter() {
        SpinnerOverlay.show();
        var url = "@Url.Action("AddElementMapFilter", new { elementName = ViewBag.ElementName })";
        $("form:first").attr("action", url).submit();
    }

    function removeElementMapFilter(elementMapFieldName) {
        SpinnerOverlay.show();
        $("<input>").attr({
            type: "hidden",
            id: "elementMapFieldName",
            name: "elementMapFieldName",
            value: elementMapFieldName
        }).appendTo("form");
        var url = "@Url.Action("RemoveElementMapFilter", new { elementName = ViewBag.ElementName })";
        $("form:first").attr("action", url).submit();
    }

</script>


<div class="row">
    <div class="col-sm-12">
        <jj-title title="@StringLocalizer["DataItem"]" size="HeadingSize.H4"/>
    </div>

    <div class="@BootstrapHelper.FormGroup col-sm-3 required">
        <label class="@BootstrapHelper.Label" for="DataItem_DataItemType" @BootstrapHelper.GetDataToggle("tooltip") title="@StringLocalizer["ListType"]">@StringLocalizer["ListType"]</label>
        <select id="DataItem_DataItemType" name="DataItem.DataItemType" onchange="this.form.requestSubmit();" class="form-control form-select">
            <option selected="selected" value="@((int)DataItemType.Dictionary)">@DataItemType.Dictionary.ToString()</option>
        </select>
    </div>

    <div class="@BootstrapHelper.FormGroup col-sm-3 required" id="divReplaceTextOnGrid">
        <label class="@BootstrapHelper.Label" @BootstrapHelper.GetDataToggle("tooltip") title="@StringLocalizer["Replace the field value with a description of the combination when displaying a grid"]">@StringLocalizer["ReplaceTextOnGrid"]</label>
        @Html.DropDownListFor(modelItem => modelItem.DataItem!.ReplaceTextOnGrid, new[]
        {
            new SelectListItem { Text = StringLocalizer["Yes"], Value = "true" },
            new SelectListItem { Text = StringLocalizer["No"], Value = "false" }
        },
            new { @class = "form-control form-select" })
    </div>

    <div class="@BootstrapHelper.FormGroup col-sm-3 required">
        <label class="@BootstrapHelper.Label " @BootstrapHelper.GetDataToggle("tooltip") title="@StringLocalizer["Dictionary Name"]">@StringLocalizer["ElementName"]</label>
        @Html.DropDownListFor(modelItem => modelItem.DataItem!.ElementMap!.ElementName,
            new SelectList(ViewBag.ElementNameList, "Key", "Value"),
            new { @class = "form-control form-select", onchange = "this.form.requestSubmit();" })
    </div>

    <div class="@BootstrapHelper.FormGroup col-sm-2 required">
        <label class="@BootstrapHelper.Label " @BootstrapHelper.GetDataToggle("tooltip") title="@StringLocalizer["Enable / Disable dictionary actions"]">@StringLocalizer["EnableElementActions"]</label>
        @Html.DropDownListFor(modelItem => modelItem.DataItem!.ElementMap!.EnableElementActions, new[]
        {
            new SelectListItem { Text = StringLocalizer["No"], Value = "false" },
            new SelectListItem { Text = StringLocalizer["Yes"], Value = "true" }
        },
            new { @class = "form-control form-select" })
    </div>
    
    <collapse-panel title="@StringLocalizer["Element Map"]" expanded-by-default="true" icon="Map">
        <div class="row">
            <div class="@BootstrapHelper.FormGroup col-sm-4 required">
                <label class="@BootstrapHelper.Label" @BootstrapHelper.GetDataToggle("tooltip") title="@StringLocalizer["Field"]">@StringLocalizer["Field Key"]</label>
                @Html.DropDownListFor(modelItem => modelItem.DataItem!.ElementMap!.FieldKey,
                    new SelectList(ViewBag.ElementFieldList, "Key", "Value"),
                    new { @class = "form-control form-select" })
            </div>
            <div class="@BootstrapHelper.FormGroup col-sm-4">
                <label class="@BootstrapHelper.Label" @BootstrapHelper.GetDataToggle("tooltip") title="@StringLocalizer["Key"]">@StringLocalizer["Field Description"]</label>
                @Html.DropDownListFor(modelItem => modelItem.DataItem!.ElementMap!.FieldDescription,
                    new SelectList(ViewBag.ElementFieldList, "Key", "Value"),
                    new { @class = "form-control form-select" })
            </div>
        </div>
    </collapse-panel>

    
    <collapse-panel title="@StringLocalizer["Filters"]" expanded-by-default="false" icon="Filter">
                <div class="row">
                    <div class="@BootstrapHelper.FormGroup col-sm-4">
                        <label class="@BootstrapHelper.Label" @BootstrapHelper.GetDataToggle("tooltip") title="@StringLocalizer["Field"]">@StringLocalizer["Field Lookup"]</label>
                        @Html.DropDownList("mapField",
                            new SelectList(ViewBag.ElementFieldList, "Key", "Value"),
                            new { @class = "form-control" })
                    </div>
                    <div class="@BootstrapHelper.FormGroup col-sm-5">
                        <label class="@BootstrapHelper.Label" @BootstrapHelper.GetDataToggle("tooltip") title="@StringLocalizer["Field"]">@StringLocalizer["Filter Expression"]</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="mapExpressionValue" name="mapExpressionValue"/>
                            <span class="input-group-btn" style="padding-left: 10px;">
                                <button class="@BootstrapHelper.DefaultButton btn-small" onclick="addElementMapFilter();">
                                    <span class="fa fa-plus-square-o"></span>&nbsp;@StringLocalizer["Add"]
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
        
                        <table class="table table-bordered table-hover">
                            <tbody>
                            @for (int i = 0; i < Model.DataItem!.ElementMap!.MapFilters.Count; i++)
                            {
                                var mapFilter = Model.DataItem.ElementMap.MapFilters[i];
                                <tr>
                                    <td>
                                        @mapFilter.FieldName <span>=</span>@mapFilter.ExpressionValue
                                        @Html.HiddenFor(x => x.DataItem!.ElementMap!.MapFilters[i].FieldName, mapFilter.FieldName)
                                        @Html.HiddenFor(x => x.DataItem!.ElementMap!.MapFilters[i].ExpressionValue, mapFilter.ExpressionValue)
                                    </td>
                                    <td style="width:80px;" align="center">
                                        <a href="#" @BootstrapHelper.GetDataToggle("tooltip") title="Delete" onclick="removeElementMapFilter('@mapFilter.FieldName');">
                                            <span class="fa fa-trash"></span>
                                        </a>
                                    </td>
                                </tr>
                            }
                            </tbody>
                        </table>
        
                    </div>
                </div>
    </collapse-panel>
    
</div>